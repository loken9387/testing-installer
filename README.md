# Install GUI

## Instructions:
The installer GUI performs **offline installation only**.
Before running it, gather all required packages using the provided script.

### Build the GUI
1. cd ~
2. mkdir git
3. cd git
4. git clone https://bitbucket.parsons.us/scm/trex/trexinstaller.git --branch Automatic-Install-GUI
5. cd trexinstaller
6. cp myscript.desktop ~/Desktop/myscript.desktop
## (Skip if not editing code and just running install script) Build a python executable
1. cd ~/git/trexinstaller/gui
2. sudo apt install python3.10-venv
3. python3 -m venv myenv 
4. source myenv/bin/activate 
5. pip install -r requirements.txt 
6. pip install pyinstaller 
7. pyinstaller --onefile install_gui.py 
8. deactivate
## Launching the script from the desktop
1. right click on desktop icon, select properties, under permissions, select None for "Others Access"
2. right click on desktop icon "Install TReX" and select allow launching
3. double click icon to launch script
4. After installation completes, a `nodeConfigWizard.desktop` file will appear
   on your Desktop. Double-click it to run the Node Config Wizard executable.

## Notes:
-on linux, you may need to reinstall libxcv-cursor0 if you encounter an erro from xcb
->>>>>>sudo apt-get update
        sudo apt-get install libxcb-cursor0
        sudo apt-get reinstall xcb
-give user xmmgr access to commands normally restricted to sudo:
->>>>>>change /etc/sudoers file with: `username ALL=(ALL) NOPASSWD: command_path`
->>>>>>trex_environment.sh needs to be changed from rc5 to rc6 and from docker-dev to docker-trex

### Preparing Offline Packages
Run `offline/gather_debs.py` to download all packages listed in `packages.csv`.
The script uses apt to fetch each package **and all of its dependencies** into
the `offline/debFiles` directory. After downloading, it sorts the `.deb` files
by modification time and writes that sequence to `package_order.txt`. This file
captures the exact order packages were retrieved so dependencies can be
installed first. Use the optional `--tar` flag to create `offline/debFiles.tar.gz`
with the downloaded packages.
After gathering the packages, execute `offline/get_fpga_images.py` to extract
the X310 and B210 FPGA images from the `uhd-images` package. The images are
placed in `offline/fpga_images` so they can be copied to the target system
without requiring internet access.

Copy all `.deb` files into a folder named `dependencies` alongside the GUI
executable. The installer reads packages from this directory during the offline
installation. If `package_order.txt` is present in `dependencies` it is used to
install the packages in the recorded order; otherwise the order from
`packages.csv` is used. The `package_order.txt` file ensures dependencies are
installed before the packages that require them so the installer can simply
process the list from top to bottom (for example the Python Docker packages will
appear before the `docker` package).

### Running the Installer in Production
The compiled GUI installs everything offline using the packages in the
`dependencies` directory.
1. Build the GUI on a development machine using PyInstaller:
   ```bash
   cd gui
   pyinstaller --onefile install_gui.py
   ```
   The executable will be placed in `gui/dist/`.
2. Create a folder called `dependencies` in the same directory as the
   executable and copy all `.deb` files from `offline/debFiles` into it. These
   files are generated by `offline/gather_debs.py`.
   After running `offline/get_fpga_images.py`, copy the contents of
   `offline/fpga_images` into `/scratch/images` on the target machine so
   `uhd_image_loader` can access the bit files offline.
3. Copy the `launch.tar` archive and any Docker image archives
   (`postgres.tar.gz`, `node-webserver.tar.gz`, `services.tar.gz`,
   `signal.tar.gz`, etc.) next to the executable. The installer will extract
   `launch.tar` to `/home/xmmgr/git/launch` and load the Docker images from
   these files.
4. The directory layout should resemble the following:
   ```
   trexinstaller/
       install_gui        # compiled executable
       dependencies/      # all .deb packages
           package1.deb
           package2.deb
           ...
       launch.tar
       postgres.tar.gz
       node-webserver.tar.gz
       services.tar.gz
       signal.tar.gz
   ```

When executed, the installer searches for the `dependencies` directory and
installs each `.deb` file found. It then loads the Docker images and unpacks
`launch.tar` before running `launchCompose.sh` to start the application.

After installation finishes, the system will automatically shut down so you can
power cycle the machine.
